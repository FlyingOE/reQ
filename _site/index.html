<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=c41c6f7b5aaedd40ee7c593b7e0fec7f1fd7307e">

<!-- Begin Jekyll SEO tag v2.4.0 -->
<title>reQ | A WIP library for HTTP requests in KDB+/q</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="reQ" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A WIP library for HTTP requests in KDB+/q" />
<meta property="og:description" content="A WIP library for HTTP requests in KDB+/q" />
<link rel="canonical" href="http://192.168.1.68:8105/" />
<meta property="og:url" content="http://192.168.1.68:8105/" />
<meta property="og:site_name" content="reQ" />
<script type="application/ld+json">
{"name":"reQ","description":"A WIP library for HTTP requests in KDB+/q","@type":"WebSite","url":"http://192.168.1.68:8105/","headline":"reQ","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="http://github.com/jonathonmcmurray/reQ">View on GitHub</a>

          <h1 id="project_title">reQ</h1>
          <h2 id="project_tagline">A WIP library for HTTP requests in KDB+/q</h2>

          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1 id="req">reQ</h1>

<p>A WIP library for HTTP requests in kdb+/q</p>

<p>kdb+ has built in functions for HTTP requests such as <code class="highlighter-rouge">.Q.hg</code> (GET) and <code class="highlighter-rouge">.Q.hp</code>(POST). However, these functions are somewhat limited by several factors. For example, using these functions you cannot supply custom HTTP headers within the requests (for example, authorization tokens that are required by many APIs, a user agent etc.). In addition, in case of an HTTP redirect response, <code class="highlighter-rouge">.Q.hg</code>/<code class="highlighter-rouge">.Q.hp</code> will fail.</p>

<p>reQ is a library designed to overcome these limitations for basic HTTP queries. It allows specifying of custom headers where necessary, and also automatically follows HTTP redirects. In addition, in case of JSON response, this will be parsed to KDB+ object automatically.</p>

<p>Additionally, reQ is now compatible with older versions of kdb+/q - there is no reliance on any <code class="highlighter-rouge">.Q</code> functions found only in more recent versions. For example, <code class="highlighter-rouge">.Q.hg</code> and <code class="highlighter-rouge">.Q.hp</code> are only available in version 3.4+, likewise with the underlying <code class="highlighter-rouge">.Q.hap</code> function etc. reQ does not rely on any of these functions, and therefore works prior to 3.4. It has been tested on version 2.7 and 3.3. <code class="highlighter-rouge">json.k</code> from kx is loaded when version is below 3.4 to enable JSON decoding on these versions also.</p>

<p>Finally, reQ has some very basic cookie support; this will be expanded upon in future updates, but for now, any cookies sent in an HTTP response will be stored in <code class="highlighter-rouge">.req.cookiejar</code> and will automatically be sent with further requests to the same host. At present, another response sending cookies will overwrite the previous set of cookies in the cookiejar. This functionality is very rudimentary and only suitable for very simple use cases.</p>

<h2 id="usage">Usage</h2>

<p>The two main entry point functions within the library are <code class="highlighter-rouge">.req.get</code> and <code class="highlighter-rouge">.req.post</code>, replacing <code class="highlighter-rouge">.Q.hg</code> and <code class="highlighter-rouge">.Q.hp</code> respectively.
Other functions are currently undocumented but will be documented in time.</p>

<h3 id="reqget"><code class="highlighter-rouge">.req.get</code></h3>

<p>Takes two args:</p>
<ul>
  <li>URL (can be string, hsym or symbol)</li>
  <li>Dictionary of HTTP headers</li>
</ul>

<h3 id="reqpost"><code class="highlighter-rouge">.req.post</code></h3>

<p>Takes three args:</p>
<ul>
  <li>URL (can be string, hsym or symbol)</li>
  <li>Dictionary of HTTP headers</li>
  <li>Payload (should be a string) -&gt; where necessary, <code class="highlighter-rouge">Content-Type</code> should be set in header dict manually. <code class="highlighter-rouge">Content-Length</code> will be added automatically</li>
</ul>

<h2 id="examples">Examples</h2>

<h3 id="custom-headers">Custom Headers</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ q req.q                                                                                                                            
KDB+ 3.5 2017.10.11 Copyright (C) 1993-2017 Kx Systems
l32/ 2()core 1945MB jonny grizzly 127.0.1.1 NONEXPIRE

q).Q.hg`:http://httpbin.org/headers
"{\n  \"headers\": {\n    \"Connection\": \"close\", \n    \"Host\": \"httpbin.org\"\n  }\n}\n"
q).req.get["http://httpbin.org/headers";`custom`headers!("with custom";"values")]
       | Accept Connection Custom        Headers  Host          User-Agent
-------| -----------------------------------------------------------------
headers| "*/*"  "close"    "with custom" "values" "httpbin.org" "kdb+/3.5"
</code></pre></div></div>

<h3 id="http-redirect">HTTP Redirect</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ q req.q                                                                                                                            
KDB+ 3.5 2017.10.11 Copyright (C) 1993-2017 Kx Systems
l32/ 2()core 1945MB jonny grizzly 127.0.1.1 NONEXPIRE

q).Q.hg`:http://httpbin.org/redirect/3
"&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\"&gt;\n&lt;title&gt;Redirecting...&lt;/title&gt;\n&lt;h1&gt;Redirecting...&lt;/h1&gt;\n&lt;p&gt;You should be redirected automatica..
q).req.get["http://httpbin.org/redirect/3";()!()]
args   | (`symbol$())!()
headers| `Accept`Connection`Host`User-Agent!("*/*";"close";"httpbin.org";"kdb+/3.5")
origin | "146.199.80.196"
url    | "http://httpbin.org/get"
</code></pre></div></div>

<h3 id="post-request">POST request</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>q).req.post["http://httpbin.org/post";enlist["Content-Type"]!enlist .req.ty`json;.j.j (1#`text)!1#`hello]
args   | (`symbol$())!()
data   | "{\"text\":\"hello\"}"
files  | (`symbol$())!()
form   | (`symbol$())!()
headers| `Accept`Connection`Content-Length`Content-Type`Host`User-Agent!("*/*";"close";"16";"application/json";"httpbin.org";"kdb+/3.5")
json   | (,`text)!,"hello"
origin | "146.199.80.196"
url    | "http://httpbin.org/post"
</code></pre></div></div>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        
        <p class="copyright">reQ maintained by <a href="http://github.com/jonathonmcmurray">jonathonmcmurray</a></p>
        
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    
  </body>
</html>
