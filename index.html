<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="HTTP request library for q language">
        
        <link rel="canonical" href="http://jmcmurray.co.uk/reQ/">
        <link rel="shortcut icon" href="./img/favicon.ico">
        <title>reQ - reQ</title>
        <link href="./css/bootstrap-3.3.7.min.css" rel="stylesheet">
        <link href="./css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" href="./css/highlight.css">
        <link href="./css/base.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="./js/jquery-1.10.2.min.js"></script>
        <script src="./js/bootstrap-3.3.7.min.js"></script>
        <script src="./js/highlight.pack.js"></script>
        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-119708613-1', 'jmcmurray.co.uk');
            ga('send', 'pageview');
        </script>
         
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href=".">reQ</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="active">
                    <a href=".">reQ</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="https://github.com/jonathonmcmurray/reQ/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="row">
                    <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
      
    
        <li class="main active"><a href="#req">reQ</a></li>
        
            <li><a href="#usage">Usage</a></li>
        
            <li><a href="#examples">Examples</a></li>
        
    
    
    </ul>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="req">reQ</h1>
<p>A WIP library for HTTP requests in kdb+/q</p>
<p>kdb+ has built in functions for HTTP requests such as <code>.Q.hg</code> (GET) and <code>.Q.hp</code>(POST). However, these functions are somewhat limited by several factors. For example, using these functions you cannot supply custom HTTP headers within the requests (for example, authorization tokens that are required by many APIs, a user agent etc.). In addition, in case of an HTTP redirect response, <code>.Q.hg</code>/<code>.Q.hp</code> will fail.</p>
<p>reQ is a library designed to overcome these limitations for basic HTTP queries. It allows specifying of custom headers where necessary, and also automatically follows HTTP redirects. In addition, in case of JSON response, this will be parsed to KDB+ object automatically.</p>
<p>Additionally, reQ is now compatible with older versions of kdb+/q - there is no reliance on any <code>.Q</code> functions found only in more recent versions. For example, <code>.Q.hg</code> and <code>.Q.hp</code> are only available in version 3.4+, likewise with the underlying <code>.Q.hap</code> function etc. reQ does not rely on any of these functions, and therefore works prior to 3.4. It has been tested on version 2.7 and 3.3. <code>json.k</code> from kx is loaded when version is below 3.4 to enable JSON decoding on these versions also.</p>
<p>Finally, reQ has some very basic cookie support; this will be expanded upon in future updates, but for now, any cookies sent in an HTTP response will be stored in <code>.req.cookiejar</code> and will automatically be sent with further requests to the same host. At present, another response sending cookies will overwrite the previous set of cookies in the cookiejar. This functionality is very rudimentary and only suitable for very simple use cases.</p>
<h2 id="usage">Usage</h2>
<p>The two main entry point functions within the library are <code>.req.get</code> and <code>.req.post</code>, replacing <code>.Q.hg</code> and <code>.Q.hp</code> respectively.
Other functions are currently undocumented but will be documented in time.</p>
<h3 id="reqget"><code>.req.get</code></h3>
<p>Takes two args:</p>
<ul>
<li>URL (can be string, hsym or symbol)</li>
<li>Dictionary of HTTP headers</li>
</ul>
<h3 id="reqpost"><code>.req.post</code></h3>
<p>Takes three args:</p>
<ul>
<li>URL (can be string, hsym or symbol)</li>
<li>Dictionary of HTTP headers</li>
<li>Payload (should be a string) -&gt; where necessary, <code>Content-Type</code> should be set in header dict manually. <code>Content-Length</code> will be added automatically</li>
</ul>
<h2 id="examples">Examples</h2>
<h3 id="custom-headers">Custom Headers</h3>
<pre><code class="q">$ q req.q
KDB+ 3.5 2017.10.11 Copyright (C) 1993-2017 Kx Systems
l32/ 2()core 1945MB jonny grizzly 127.0.1.1 NONEXPIRE

q).Q.hg`:http://httpbin.org/headers
&quot;{\n  \&quot;headers\&quot;: {\n    \&quot;Connection\&quot;: \&quot;close\&quot;, \n    \&quot;Host\&quot;: \&quot;httpbin.org\&quot;\n  }\n}\n&quot;
q).req.get[&quot;http://httpbin.org/headers&quot;;`custom`headers!(&quot;with custom&quot;;&quot;values&quot;)]
       | Accept Connection Custom        Headers  Host          User-Agent
-------| -----------------------------------------------------------------
headers| &quot;*/*&quot;  &quot;close&quot;    &quot;with custom&quot; &quot;values&quot; &quot;httpbin.org&quot; &quot;kdb+/3.5&quot;
</code></pre>

<h3 id="http-redirect">HTTP Redirect</h3>
<pre><code class="q">$ q req.q
KDB+ 3.5 2017.10.11 Copyright (C) 1993-2017 Kx Systems
l32/ 2()core 1945MB jonny grizzly 127.0.1.1 NONEXPIRE

q).Q.hg`:http://httpbin.org/redirect/3
&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 3.2 Final//EN\&quot;&gt;\n&lt;title&gt;Redirecting...&lt;/title&gt;\n&lt;h1&gt;Redirecting...&lt;/h1&gt;\n&lt;p&gt;You should be redirected automatica..
q).req.get[&quot;http://httpbin.org/redirect/3&quot;;()!()]
args   | (`symbol$())!()
headers| `Accept`Connection`Host`User-Agent!(&quot;*/*&quot;;&quot;close&quot;;&quot;httpbin.org&quot;;&quot;kdb+/3.5&quot;)
origin | &quot;146.199.80.196&quot;
url    | &quot;http://httpbin.org/get&quot;
</code></pre>

<h3 id="post-request">POST request</h3>
<pre><code class="q">q).req.post[&quot;http://httpbin.org/post&quot;;enlist[&quot;Content-Type&quot;]!enlist .req.ty`json;.j.j (1#`text)!1#`hello]
args   | (`symbol$())!()
data   | &quot;{\&quot;text\&quot;:\&quot;hello\&quot;}&quot;
files  | (`symbol$())!()
form   | (`symbol$())!()
headers| `Accept`Connection`Content-Length`Content-Type`Host`User-Agent!(&quot;*/*&quot;;&quot;close&quot;;&quot;16&quot;;&quot;application/json&quot;;&quot;httpbin.org&quot;;&quot;kdb+/3.5&quot;)
json   | (,`text)!,&quot;hello&quot;
origin | &quot;146.199.80.196&quot;
url    | &quot;http://httpbin.org/post&quot;
</code></pre></div>
                </div>
        </div>

    <hr>
    <footer class="container">
        
        <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
    </footer>
        <script src="./js/base.js"></script>
        <script src="./search/require.js"></script>
        <script src="./search/search.js"></script>
    </body>
</html>